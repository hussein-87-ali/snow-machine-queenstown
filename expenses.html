<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Group Trip Expenses üí∏ | Sam ‚Ä¢ Huss ‚Ä¢ Sharon ‚Ä¢ Jhye</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Nunito', sans-serif;
      background-color: #f5f0e8;
      min-height: 100vh;
    }
    
    /* Header */
    header {
      background-color: #4a5d4a;
      padding: 2rem 1.5rem;
    }
    
    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    header h1 {
      font-size: 1.875rem;
      font-weight: 300;
      color: white;
      letter-spacing: 0.05em;
    }
    
    header p {
      color: rgba(255,255,255,0.8);
      margin-top: 0.5rem;
    }
    
    .nav-link {
      background: rgba(255,255,255,0.2);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      text-decoration: none;
      font-size: 0.875rem;
      transition: background 0.2s;
    }
    
    .nav-link:hover {
      background: rgba(255,255,255,0.3);
    }
    
    /* Navigation Tabs */
    nav {
      background-color: #e8e0d0;
      border-bottom: 1px solid #c9bda8;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    .nav-tabs {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1.5rem;
      display: flex;
      gap: 0.25rem;
      overflow-x: auto;
    }
    
    .tab-btn {
      padding: 1rem 1.5rem;
      font-family: 'Nunito', sans-serif;
      font-weight: 500;
      font-size: 1rem;
      background: none;
      border: none;
      border-bottom: 2px solid transparent;
      color: #78716c;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s;
    }
    
    .tab-btn:hover {
      color: #44403c;
    }
    
    .tab-btn.active {
      color: #44403c;
      border-bottom-color: #6b7c5e;
    }
    
    /* Main Content */
    main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Cards */
    .card {
      background: white;
      border-radius: 0.75rem;
      padding: 1.5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 1.5rem;
    }
    
    .card-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }
    
    .card-icon {
      width: 2.5rem;
      height: 2.5rem;
      border-radius: 50%;
      background-color: #4a5d4a;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.125rem;
    }
    
    .card-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: #44403c;
    }
    
    .card-subtitle {
      font-size: 0.875rem;
      color: #78716c;
    }
    
    /* Payment Cards */
    .payment-card {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1.25rem;
      background: #f8faf8;
      border: 2px solid #c5d4c5;
      border-radius: 0.75rem;
      margin-bottom: 1rem;
    }
    
    .payment-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .avatar {
      width: 3rem;
      height: 3rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 1.125rem;
    }
    
    .avatar.debtor {
      background-color: #b45309;
    }
    
    .avatar.creditor {
      background-color: #4a7c4a;
    }
    
    .avatar.neutral {
      background-color: #6b7c5e;
    }
    
    .payment-names {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .payment-names span {
      font-weight: 600;
      font-size: 1.125rem;
      color: #44403c;
    }
    
    .arrow {
      color: #a8a29e;
    }
    
    .payment-amount {
      font-size: 1.5rem;
      font-weight: 700;
      color: #4a5d4a;
    }
    
    /* Info Box */
    .info-box {
      padding: 1rem;
      border-radius: 0.5rem;
      font-size: 0.875rem;
    }
    
    .info-box.success {
      background: #e8f5e8;
      color: #166534;
    }
    
    .info-box.warning {
      background: #fef9f0;
      color: #92400e;
    }
    
    .info-box.neutral {
      background: #f5f0e8;
      color: #57534e;
    }
    
    /* Optimization Grid */
    .optimization-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }
    
    @media (max-width: 768px) {
      .optimization-grid {
        grid-template-columns: 1fr;
      }
    }
    
    .optimization-box {
      padding: 1rem;
      border-radius: 0.5rem;
      border: 1px solid;
    }
    
    .optimization-box.before {
      background: #fef9f0;
      border-color: #e8dcc8;
    }
    
    .optimization-box.after {
      background: #e8f5e8;
      border-color: #c5d4c5;
    }
    
    .optimization-box h3 {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      margin-bottom: 0.75rem;
    }
    
    .optimization-box.before h3 {
      color: #92400e;
    }
    
    .optimization-box.after h3 {
      color: #166534;
    }
    
    .optimization-item {
      display: flex;
      justify-content: space-between;
      font-size: 0.875rem;
      padding: 0.25rem 0;
    }
    
    .optimization-box.before .optimization-item {
      color: #b45309;
    }
    
    .optimization-box.after .optimization-item {
      color: #15803d;
    }
    
    /* Settlement Card */
    .settlement-card {
      border: 1px solid #e0d8c8;
      border-radius: 0.75rem;
      overflow: hidden;
      margin-bottom: 1.5rem;
    }
    
    .settlement-header {
      background: #f8f5f0;
      padding: 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .settlement-people {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .settlement-person {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .settlement-person .avatar {
      width: 2rem;
      height: 2rem;
      font-size: 0.875rem;
    }
    
    .settlement-content {
      padding: 1rem;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 1rem;
    }
    
    @media (max-width: 768px) {
      .settlement-content {
        grid-template-columns: 1fr;
      }
    }
    
    .settlement-box {
      padding: 0.75rem;
      border-radius: 0.5rem;
    }
    
    .settlement-box.owes {
      background: #fef9f0;
    }
    
    .settlement-box.net {
      background: #e8f5e8;
    }
    
    .settlement-box.even {
      background: #f0f0f0;
    }
    
    .settlement-box-label {
      font-size: 0.75rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
    }
    
    .settlement-box.owes .settlement-box-label {
      color: #b45309;
    }
    
    .settlement-box.net .settlement-box-label {
      color: #4a7c4a;
    }
    
    .settlement-box-amount {
      font-size: 1.25rem;
      font-weight: 700;
    }
    
    .settlement-box.owes .settlement-box-amount {
      color: #92400e;
    }
    
    .settlement-box.net .settlement-box-amount {
      color: #4a5d4a;
    }
    
    .settlement-box-direction {
      font-size: 0.875rem;
      margin-top: 0.25rem;
      color: #4a7c4a;
    }
    
    .settlement-items {
      margin-top: 0.5rem;
      font-size: 0.75rem;
      color: #b45309;
    }
    
    .settlement-items div {
      display: flex;
      justify-content: space-between;
      padding: 0.125rem 0;
    }
    
    /* Person Position Cards */
    .position-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
    }
    
    @media (max-width: 768px) {
      .position-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    .position-card {
      padding: 1rem;
      border-radius: 0.75rem;
      text-align: center;
    }
    
    .position-card.receiving {
      background: #e8f5e8;
    }
    
    .position-card.paying {
      background: #fef9f0;
    }
    
    .position-card.settled {
      background: #f5f5f5;
    }
    
    .position-card .avatar {
      width: 3.5rem;
      height: 3.5rem;
      font-size: 1.25rem;
      margin: 0 auto 0.75rem;
    }
    
    .position-card h3 {
      font-weight: 600;
      color: #44403c;
    }
    
    .position-status {
      font-size: 0.875rem;
      margin-top: 0.5rem;
    }
    
    .position-card.receiving .position-status {
      color: #15803d;
    }
    
    .position-card.paying .position-status {
      color: #b45309;
    }
    
    .position-card.settled .position-status {
      color: #78716c;
    }
    
    .position-amount {
      font-size: 1.25rem;
      font-weight: 700;
    }
    
    .position-card.receiving .position-amount {
      color: #166534;
    }
    
    .position-card.paying .position-amount {
      color: #92400e;
    }
    
    .position-card.settled .position-amount {
      color: #57534e;
    }
    
    /* Summary Cards Grid */
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1.5rem;
    }
    
    @media (max-width: 768px) {
      .summary-grid {
        grid-template-columns: 1fr;
      }
    }
    
    .summary-card {
      background: white;
      border-radius: 0.75rem;
      padding: 1.5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .summary-card-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }
    
    .summary-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid #e8e0d0;
    }
    
    .summary-row:last-child {
      border-bottom: none;
    }
    
    .summary-label {
      color: #57534e;
    }
    
    .summary-value {
      font-weight: 600;
      color: #44403c;
    }
    
    .summary-value.positive {
      color: #4a7c4a;
    }
    
    .summary-value.negative {
      color: #b45309;
    }
    
    .owes-box, .owed-box {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 0.5rem;
    }
    
    .owes-box {
      background: #fef3e2;
    }
    
    .owed-box {
      background: #e8f5e8;
    }
    
    .owes-box h4 {
      font-size: 0.875rem;
      font-weight: 500;
      color: #92400e;
      margin-bottom: 0.5rem;
    }
    
    .owed-box h4 {
      font-size: 0.875rem;
      font-weight: 500;
      color: #166534;
      margin-bottom: 0.5rem;
    }
    
    .owes-item, .owed-item {
      display: flex;
      justify-content: space-between;
      font-size: 0.875rem;
    }
    
    .owes-item {
      color: #b45309;
    }
    
    .owed-item {
      color: #15803d;
    }
    
    /* Expense Cards */
    .expense-card {
      background: white;
      border-radius: 0.75rem;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 1rem;
    }
    
    .expense-header {
      background: #f0ebe3;
      border-bottom: 1px solid #e0d8c8;
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }
    
    .expense-title {
      font-weight: 600;
      color: #44403c;
    }
    
    .expense-meta {
      font-size: 0.875rem;
      color: #78716c;
      margin-top: 0.25rem;
    }
    
    .expense-note {
      font-size: 0.75rem;
      color: #a8a29e;
      font-style: italic;
      margin-top: 0.25rem;
    }
    
    .expense-total {
      text-align: right;
    }
    
    .expense-total-amount {
      font-size: 1.125rem;
      font-weight: 600;
      color: #44403c;
    }
    
    .expense-per-person {
      font-size: 0.875rem;
      color: #78716c;
    }
    
    .expense-payments {
      padding: 1rem;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0.75rem;
    }
    
    @media (max-width: 768px) {
      .expense-payments {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    .expense-payment {
      padding: 0.75rem;
      border-radius: 0.5rem;
    }
    
    .expense-payment.paid {
      background: #e8f5e8;
    }
    
    .expense-payment.unpaid {
      background: #fef9f0;
    }
    
    .expense-payment-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }
    
    .expense-payment-header .avatar {
      width: 1.5rem;
      height: 1.5rem;
      font-size: 0.75rem;
    }
    
    .expense-payment-header span {
      font-weight: 500;
      font-size: 0.875rem;
      color: #57534e;
    }
    
    .expense-payment-amount {
      font-weight: 600;
      color: #44403c;
    }
    
    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
      margin-top: 0.25rem;
    }
    
    .status-badge.paid {
      background: #dcfce7;
      color: #166534;
    }
    
    .status-badge.unpaid {
      background: #fef3c7;
      color: #92400e;
    }
    
    .payment-note {
      font-size: 0.75rem;
      color: #b45309;
      margin-top: 0.25rem;
    }
    
    /* Table */
    .data-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .data-table th {
      background: #f0ebe3;
      text-align: left;
      padding: 0.75rem;
      color: #57534e;
      font-weight: 500;
    }
    
    .data-table th:not(:first-child) {
      text-align: center;
    }
    
    .data-table td {
      padding: 0.75rem;
      border-bottom: 1px solid #e8e0d0;
      font-size: 0.875rem;
      color: #57534e;
    }
    
    .data-table td:not(:first-child) {
      text-align: center;
    }
    
    .data-table tr:last-child td {
      border-bottom: none;
    }
    
    .data-table tfoot tr {
      background: #f8f5f0;
    }
    
    .data-table tfoot td {
      font-weight: 600;
      color: #44403c;
    }
    
    .unpaid-amount {
      color: #b45309;
      font-weight: 500;
    }
    
    .dash {
      color: #d6d3d1;
    }
    
    /* Legend */
    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      color: #57534e;
    }
    
    .legend-color {
      width: 1rem;
      height: 1rem;
      border-radius: 0.25rem;
    }
    
    .legend-color.paid {
      background: #e8f5e8;
    }
    
    .legend-color.unpaid {
      background: #fef9f0;
    }
    
    /* Footer */
    footer {
      background: #e8e0d0;
      padding: 1.5rem;
      text-align: center;
    }
    
    footer p {
      font-size: 0.875rem;
      color: #78716c;
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div>
        <h1>üí∏ Group Trip Expenses</h1>
        <p>Sam ‚Ä¢ Huss ‚Ä¢ Sharon ‚Ä¢ Jhye</p>
      </div>
      <a href="index.html" class="nav-link">üèîÔ∏è Snow Machine Accommodation</a>
    </div>
  </header>
  
  <nav>
    <div class="nav-tabs">
      <button class="tab-btn active" data-tab="netsettlements">‚ú® Net Settlements</button>
      <button class="tab-btn" data-tab="summary">üë• Summary</button>
      <button class="tab-btn" data-tab="expenses">üìã Expenses</button>
      <button class="tab-btn" data-tab="settlements">üìä Settlements</button>
    </div>
  </nav>
  
  <main>
    <!-- Net Settlements Tab -->
    <div id="netsettlements" class="tab-content active"></div>
    
    <!-- Summary Tab -->
    <div id="summary" class="tab-content"></div>
    
    <!-- Expenses Tab -->
    <div id="expenses" class="tab-content"></div>
    
    <!-- Settlements Tab -->
    <div id="settlements" class="tab-content"></div>
  </main>
  
  <footer>
    <p>Trip expense tracker ‚Ä¢ Last updated Feb 2026 ‚úàÔ∏è</p>
  </footer>

  <script>
    // Data
    const expenses = [
      {
        id: 1,
        item: 'San Diego Accommodation',
        total: 1425,
        nights: 3,
        perPerson: 356.25,
        bookedBy: 'Sam',
        payments: {
          Sam: { amount: 356.25, status: 'paid' },
          Huss: { amount: 356.25, status: 'unpaid' },
          Sharon: { amount: 356.25, status: 'unpaid' },
          Jhye: { amount: 356.25, status: 'paid' }
        }
      },
      {
        id: 2,
        item: 'Cancun Accommodation',
        total: 1500,
        nights: 5,
        perPerson: 375,
        bookedBy: 'Sharon',
        payments: {
          Sam: { amount: 375, status: 'paid' },
          Huss: { amount: 375, status: 'unpaid' },
          Sharon: { amount: 265.40, status: 'paid' },
          Jhye: { amount: 375, status: 'paid' }
        }
      },
      {
        id: 3,
        item: 'Houston Accommodation',
        total: 322,
        nights: 1,
        perPerson: 80.5,
        bookedBy: 'Sam',
        payments: {
          Sam: { amount: 80.5, status: 'paid' },
          Huss: { amount: 80.5, status: 'unpaid' },
          Sharon: { amount: 80.5, status: 'unpaid' },
          Jhye: { amount: 80.5, status: 'paid' }
        }
      },
      {
        id: 4,
        item: 'Lafayette Accommodation',
        total: 380,
        nights: 1,
        perPerson: 95,
        bookedBy: 'Sharon',
        payments: {
          Sam: { amount: 95, status: 'paid' },
          Huss: { amount: 95, status: 'unpaid' },
          Sharon: { amount: 95, status: 'paid' },
          Jhye: { amount: 95, status: 'paid' }
        }
      },
      {
        id: 5,
        item: 'New Orleans Accommodation',
        total: 692,
        nights: 2,
        perPerson: 173,
        bookedBy: 'Sharon',
        payments: {
          Sam: { amount: 173, status: 'unpaid' },
          Huss: { amount: 173, status: 'unpaid' },
          Sharon: { amount: 173, status: 'paid' },
          Jhye: { amount: 173, status: 'unpaid' }
        }
      },
      {
        id: 6,
        item: 'Nashville Accommodation',
        total: 1374,
        nights: 2,
        perPerson: 343.5,
        bookedBy: 'Sharon',
        payments: {
          Sam: { amount: 343.5, status: 'unpaid' },
          Huss: { amount: 343.5, status: 'unpaid' },
          Sharon: { amount: 343.5, status: 'paid' },
          Jhye: { amount: 343.5, status: 'unpaid' }
        }
      },
      {
        id: 7,
        item: 'Car Hire LA to Vegas',
        total: 760,
        days: 9,
        perPerson: 190,
        bookedBy: 'Sam',
        payments: {
          Sam: { amount: 190, status: 'paid' },
          Huss: { amount: 190, status: 'unpaid' },
          Sharon: { amount: 190, status: 'unpaid' },
          Jhye: { amount: 190, status: 'paid' }
        }
      },
      {
        id: 8,
        item: 'Flights Vegas to Cancun',
        total: 1753.6,
        perPerson: 438.4,
        bookedBy: 'Sam',
        bookedBySecondary: 'Huss',
        note: 'Sam booked for Sam+Jhye, Huss booked for Huss+Sharon',
        payments: {
          Sam: { amount: 438.4, status: 'paid', paidTo: 'Self' },
          Huss: { amount: 438.4, status: 'paid', paidTo: 'Self' },
          Sharon: { amount: 438.4, status: 'unpaid', owesTo: 'Huss' },
          Jhye: { amount: 438.4, status: 'paid', paidTo: 'Sam', note: 'Add bag charge' }
        }
      },
      {
        id: 9,
        item: 'Flights Cancun to Houston',
        total: 1689.6,
        perPerson: 422.4,
        bookedBy: 'Sam',
        bookedBySecondary: 'Huss',
        note: 'Sam booked for Sam+Jhye ($488.70 each), Huss booked for Huss+Sharon ($356.30 each)',
        payments: {
          Sam: { amount: 488.7, status: 'paid', paidTo: 'Self' },
          Huss: { amount: 356.3, status: 'paid', paidTo: 'Self' },
          Sharon: { amount: 356.3, status: 'unpaid', owesTo: 'Huss' },
          Jhye: { amount: 488.7, status: 'paid', paidTo: 'Sam' }
        }
      },
      {
        id: 10,
        item: 'Flights Nashville to Chicago',
        total: 948.8,
        perPerson: 237.2,
        bookedBy: 'Sam',
        payments: {
          Sam: { amount: 237.2, status: 'paid' },
          Huss: { amount: 237.2, status: 'unpaid' },
          Sharon: { amount: 237.2, status: 'unpaid' },
          Jhye: { amount: 237.2, status: 'paid' }
        }
      },
      {
        id: 11,
        item: 'Flights Chicago to LA',
        total: 1198,
        perPerson: 299.5,
        bookedBy: 'Huss',
        payments: {
          Sam: { amount: 299.5, status: 'paid' },
          Huss: { amount: 299.5, status: 'paid' },
          Sharon: { amount: 299.5, status: 'unpaid' },
          Jhye: { amount: 299.5, status: 'paid' }
        }
      }
    ];
    
    const people = ['Sam', 'Huss', 'Sharon', 'Jhye'];
    
    // Helper functions
    function formatCurrency(amount) {
      return '$' + amount.toFixed(2);
    }
    
    function calculateRawDebts() {
      const debts = {};
      
      people.forEach(from => {
        debts[from] = {};
        people.forEach(to => {
          debts[from][to] = { amount: 0, items: [] };
        });
      });
      
      expenses.forEach(expense => {
        people.forEach(person => {
          const payment = expense.payments[person];
          if (payment.status === 'unpaid') {
            let owesTo = payment.owesTo || expense.bookedBy;
            if (owesTo !== person) {
              debts[person][owesTo].amount += payment.amount;
              debts[person][owesTo].items.push({
                item: expense.item,
                amount: payment.amount
              });
            }
          }
        });
      });
      
      return debts;
    }
    
    function calculateNetSettlements() {
      const rawDebts = calculateRawDebts();
      const netSettlements = [];
      const processed = new Set();
      
      people.forEach(personA => {
        people.forEach(personB => {
          if (personA !== personB && !processed.has(`${personB}-${personA}`)) {
            const aOwesB = rawDebts[personA][personB].amount;
            const bOwesA = rawDebts[personB][personA].amount;
            
            if (aOwesB > 0 || bOwesA > 0) {
              const net = aOwesB - bOwesA;
              
              netSettlements.push({
                personA,
                personB,
                aOwesB,
                bOwesA,
                aOwesBItems: rawDebts[personA][personB].items,
                bOwesAItems: rawDebts[personB][personA].items,
                netAmount: Math.abs(net),
                netDirection: net > 0 ? `${personA} ‚Üí ${personB}` : net < 0 ? `${personB} ‚Üí ${personA}` : 'Even',
                netFrom: net > 0 ? personA : personB,
                netTo: net > 0 ? personB : personA
              });
            }
            processed.add(`${personA}-${personB}`);
          }
        });
      });
      
      return netSettlements;
    }
    
    function calculateFinalPayments() {
      const balances = {};
      people.forEach(p => balances[p] = 0);
      
      const rawDebts = calculateRawDebts();
      
      people.forEach(person => {
        people.forEach(other => {
          if (person !== other) {
            balances[person] -= rawDebts[person][other].amount;
          }
        });
      });
      people.forEach(person => {
        people.forEach(other => {
          if (person !== other) {
            balances[person] += rawDebts[other][person].amount;
          }
        });
      });
      
      const creditors = [];
      const debtors = [];
      
      people.forEach(person => {
        if (balances[person] > 0.01) {
          creditors.push({ person, amount: balances[person] });
        } else if (balances[person] < -0.01) {
          debtors.push({ person, amount: -balances[person] });
        }
      });
      
      creditors.sort((a, b) => b.amount - a.amount);
      debtors.sort((a, b) => b.amount - a.amount);
      
      const simplifiedPayments = [];
      
      while (debtors.length > 0 && creditors.length > 0) {
        const debtor = debtors[0];
        const creditor = creditors[0];
        
        const paymentAmount = Math.min(debtor.amount, creditor.amount);
        
        if (paymentAmount > 0.01) {
          simplifiedPayments.push({
            from: debtor.person,
            to: creditor.person,
            amount: Math.round(paymentAmount * 100) / 100
          });
        }
        
        debtor.amount -= paymentAmount;
        creditor.amount -= paymentAmount;
        
        if (debtor.amount < 0.01) debtors.shift();
        if (creditor.amount < 0.01) creditors.shift();
      }
      
      return simplifiedPayments;
    }
    
    function calculateUnsimplifiedPayments() {
      const netSettlements = calculateNetSettlements();
      return netSettlements
        .filter(s => s.netAmount > 0)
        .map(s => ({
          from: s.netFrom,
          to: s.netTo,
          amount: s.netAmount
        }));
    }
    
    function calculatePersonSummary(person) {
      const rawDebts = calculateRawDebts();
      let totalOwed = 0;
      let totalPaid = 0;
      let owesTo = {};
      let owedBy = {};
      
      expenses.forEach(expense => {
        const payment = expense.payments[person];
        if (payment.status === 'paid') {
          totalPaid += payment.amount;
        } else {
          totalOwed += payment.amount;
        }
      });
      
      people.forEach(other => {
        if (rawDebts[person][other].amount > 0) {
          owesTo[other] = rawDebts[person][other].amount;
        }
      });
      
      people.forEach(other => {
        if (rawDebts[other][person].amount > 0) {
          owedBy[other] = rawDebts[other][person].amount;
        }
      });
      
      return { totalOwed, totalPaid, owesTo, owedBy };
    }
    
    // Render functions
    function renderNetSettlements() {
      const container = document.getElementById('netsettlements');
      const finalPayments = calculateFinalPayments();
      const unsimplifiedPayments = calculateUnsimplifiedPayments();
      const netSettlements = calculateNetSettlements();
      const rawDebts = calculateRawDebts();
      
      // Calculate net balances for explanation
      const netBalances = {};
      people.forEach(person => {
        let owes = 0;
        let isOwed = 0;
        people.forEach(other => {
          if (person !== other) {
            owes += rawDebts[person][other].amount;
            isOwed += rawDebts[other][person].amount;
          }
        });
        netBalances[person] = { owes, isOwed, net: isOwed - owes };
      });
      
      let html = `
        <!-- Final Payments -->
        <div class="card">
          <div class="card-header">
            <div class="card-icon">‚úì</div>
            <div>
              <h2 class="card-title">Final Payments Needed</h2>
              <p class="card-subtitle">Fully optimized ‚Äî minimum transfers possible</p>
            </div>
          </div>
          
          ${finalPayments.map(payment => `
            <div class="payment-card">
              <div class="payment-info">
                <div class="avatar debtor">${payment.from[0]}</div>
                <div class="payment-names">
                  <span>${payment.from}</span>
                  <span class="arrow">‚Üí</span>
                  <span>${payment.to}</span>
                </div>
                <div class="avatar creditor">${payment.to[0]}</div>
              </div>
              <div class="payment-amount">${formatCurrency(payment.amount)}</div>
            </div>
          `).join('')}
          
          <div class="info-box success">
            <strong>Only ${finalPayments.length} transfers needed!</strong> Optimized from ${unsimplifiedPayments.length} transfers by consolidating debts.
          </div>
        </div>
        
        <!-- Optimization Breakdown -->
        <div class="card">
          <h2 class="card-title">Optimization Breakdown</h2>
          <p class="card-subtitle" style="margin-bottom: 1.5rem;">How we reduced ${unsimplifiedPayments.length} transfers down to ${finalPayments.length}</p>
          
          <div class="optimization-grid">
            <div class="optimization-box before">
              <h3>‚úó Before Optimization (${unsimplifiedPayments.length} transfers)</h3>
              ${unsimplifiedPayments.map(p => `
                <div class="optimization-item">
                  <span>${p.from} ‚Üí ${p.to}</span>
                  <span style="font-weight: 500;">${formatCurrency(p.amount)}</span>
                </div>
              `).join('')}
            </div>
            
            <div class="optimization-box after">
              <h3>‚úì After Optimization (${finalPayments.length} transfers)</h3>
              ${finalPayments.map(p => `
                <div class="optimization-item">
                  <span>${p.from} ‚Üí ${p.to}</span>
                  <span style="font-weight: 500;">${formatCurrency(p.amount)}</span>
                </div>
              `).join('')}
            </div>
          </div>
          
          <div class="info-box neutral" style="margin-top: 1rem;">
            <p style="font-weight: 600; margin-bottom: 0.5rem;">How the optimization works:</p>
            <p style="font-size: 0.875rem; margin-bottom: 0.75rem;">
              Instead of money bouncing between people, we calculate everyone's <strong>net balance</strong> 
              (total owed to them minus total they owe), then create the minimum transfers to settle those balances.
            </p>
            <p style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem;">Net balances:</p>
            <ul style="font-size: 0.75rem; list-style: disc; margin-left: 1.25rem; margin-bottom: 0.75rem;">
              ${people.map(person => {
                const bal = netBalances[person];
                if (bal.net > 0.01) {
                  return `<li><strong>${person}:</strong> Is owed ${formatCurrency(bal.net)} net (creditor)</li>`;
                } else if (bal.net < -0.01) {
                  return `<li><strong>${person}:</strong> Owes ${formatCurrency(Math.abs(bal.net))} net (debtor)</li>`;
                } else {
                  return `<li><strong>${person}:</strong> All square</li>`;
                }
              }).join('')}
            </ul>
            <p style="font-size: 0.75rem;">
              <strong>Key insight:</strong> Some people act as "middlemen" ‚Äî they receive money from some but owe to others. 
              We redirect payments to skip middlemen where possible, reducing total transfers.
            </p>
          </div>
        </div>
        
        <!-- How It's Calculated - ITEMIZED -->
        <div class="card">
          <h2 class="card-title">How It's Calculated (Itemized)</h2>
          <p class="card-subtitle" style="margin-bottom: 1.5rem;">Every debt broken down by expense item</p>
          
          ${netSettlements.map(settlement => `
            <div class="settlement-card">
              <div class="settlement-header">
                <div class="settlement-people">
                  <div class="settlement-person">
                    <div class="avatar neutral">${settlement.personA[0]}</div>
                    <span style="font-weight: 500; color: #57534e;">${settlement.personA}</span>
                  </div>
                  <span style="color: #a8a29e;">‚Üî</span>
                  <div class="settlement-person">
                    <div class="avatar neutral">${settlement.personB[0]}</div>
                    <span style="font-weight: 500; color: #57534e;">${settlement.personB}</span>
                  </div>
                </div>
                <div style="text-align: right;">
                  ${settlement.netAmount > 0.01 ? `
                    <span style="padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 500; background: #e8f5e8; color: #166534;">
                      Net: ${settlement.netFrom} ‚Üí ${settlement.netTo} ${formatCurrency(settlement.netAmount)}
                    </span>
                  ` : `
                    <span style="padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 500; background: #f3f4f6; color: #4b5563;">
                      Even
                    </span>
                  `}
                </div>
              </div>
              
              <div class="settlement-content" style="grid-template-columns: 1fr 1fr;">
                <!-- A owes B - ITEMIZED -->
                <div class="settlement-box owes">
                  <div class="settlement-box-label">${settlement.personA} owes ${settlement.personB}:</div>
                  ${settlement.aOwesBItems.length > 0 ? `
                    <div style="margin-top: 0.5rem;">
                      ${settlement.aOwesBItems.map(item => `
                        <div style="display: flex; justify-content: space-between; font-size: 0.875rem; padding: 0.5rem; background: #fff7ed; border-radius: 0.25rem; margin-bottom: 0.25rem;">
                          <span style="color: #b45309;">${item.item}</span>
                          <span style="font-weight: 500; color: #92400e;">${formatCurrency(item.amount)}</span>
                        </div>
                      `).join('')}
                      <div style="display: flex; justify-content: space-between; font-size: 0.875rem; font-weight: 600; padding-top: 0.5rem; border-top: 1px solid #fed7aa; margin-top: 0.5rem;">
                        <span style="color: #92400e;">Total</span>
                        <span style="color: #92400e;">${formatCurrency(settlement.aOwesB)}</span>
                      </div>
                    </div>
                  ` : `
                    <p style="font-size: 0.875rem; color: #a8a29e; font-style: italic; margin-top: 0.5rem;">Nothing owed</p>
                  `}
                </div>
                
                <!-- B owes A - ITEMIZED -->
                <div class="settlement-box owes">
                  <div class="settlement-box-label">${settlement.personB} owes ${settlement.personA}:</div>
                  ${settlement.bOwesAItems.length > 0 ? `
                    <div style="margin-top: 0.5rem;">
                      ${settlement.bOwesAItems.map(item => `
                        <div style="display: flex; justify-content: space-between; font-size: 0.875rem; padding: 0.5rem; background: #fff7ed; border-radius: 0.25rem; margin-bottom: 0.25rem;">
                          <span style="color: #b45309;">${item.item}</span>
                          <span style="font-weight: 500; color: #92400e;">${formatCurrency(item.amount)}</span>
                        </div>
                      `).join('')}
                      <div style="display: flex; justify-content: space-between; font-size: 0.875rem; font-weight: 600; padding-top: 0.5rem; border-top: 1px solid #fed7aa; margin-top: 0.5rem;">
                        <span style="color: #92400e;">Total</span>
                        <span style="color: #92400e;">${formatCurrency(settlement.bOwesA)}</span>
                      </div>
                    </div>
                  ` : `
                    <p style="font-size: 0.875rem; color: #a8a29e; font-style: italic; margin-top: 0.5rem;">Nothing owed</p>
                  `}
                </div>
              </div>
              
              <!-- Net calculation -->
              ${settlement.netAmount > 0.01 ? `
                <div style="padding: 0 1rem 1rem 1rem;">
                  <div style="padding: 0.75rem; background: #f0fdf4; border-radius: 0.5rem;">
                    <p style="font-size: 0.875rem; color: #166534;">
                      <strong>Calculation:</strong> ${formatCurrency(settlement.aOwesB)} ‚àí ${formatCurrency(settlement.bOwesA)} = ${formatCurrency(settlement.netAmount)}<br>
                      <strong>Result:</strong> ${settlement.netFrom} pays ${settlement.netTo} ${formatCurrency(settlement.netAmount)}
                    </p>
                  </div>
                </div>
              ` : ''}
            </div>
          `).join('')}
        </div>
        
        <!-- Everyone's Net Balance -->
        <div class="card">
          <h2 class="card-title">Everyone's Net Balance</h2>
          <p class="card-subtitle" style="margin-bottom: 1.5rem;">This is the key ‚Äî everyone's final position stays the same regardless of how many transfers we use</p>
          
          <div class="position-grid">
            ${people.map(person => {
              let owes = 0;
              let isOwed = 0;
              
              people.forEach(other => {
                if (person !== other) {
                  owes += rawDebts[person][other].amount;
                  isOwed += rawDebts[other][person].amount;
                }
              });
              
              const netPosition = isOwed - owes;
              const positionClass = netPosition > 0.01 ? 'receiving' : netPosition < -0.01 ? 'paying' : 'settled';
              
              return `
                <div class="position-card ${positionClass}">
                  <div class="avatar neutral">${person[0]}</div>
                  <h3>${person}</h3>
                  
                  <div style="margin-top: 0.75rem; font-size: 0.75rem;">
                    <div style="display: flex; justify-content: space-between;">
                      <span style="color: #78716c;">Is owed:</span>
                      <span style="color: #15803d;">+${formatCurrency(isOwed)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                      <span style="color: #78716c;">Owes:</span>
                      <span style="color: #b45309;">-${formatCurrency(owes)}</span>
                    </div>
                    <div style="border-top: 1px solid #e0d8c8; padding-top: 0.25rem; margin-top: 0.25rem;">
                      <div style="display: flex; justify-content: space-between; font-weight: 600;">
                        <span style="color: #57534e;">Net:</span>
                        <span style="color: ${netPosition > 0 ? '#166534' : netPosition < 0 ? '#b45309' : '#6b7280'};">
                          ${netPosition >= 0 ? '+' : ''}${formatCurrency(netPosition)}
                        </span>
                      </div>
                    </div>
                  </div>
                  
                  <div style="margin-top: 0.75rem; text-align: center;">
                    ${netPosition > 0.01 ? `
                      <span style="font-size: 0.75rem; padding: 0.25rem 0.5rem; border-radius: 9999px; background: #dcfce7; color: #166534;">
                        Receives ${formatCurrency(netPosition)}
                      </span>
                    ` : netPosition < -0.01 ? `
                      <span style="font-size: 0.75rem; padding: 0.25rem 0.5rem; border-radius: 9999px; background: #fef3c7; color: #92400e;">
                        Pays ${formatCurrency(Math.abs(netPosition))}
                      </span>
                    ` : `
                      <span style="font-size: 0.75rem; padding: 0.25rem 0.5rem; border-radius: 9999px; background: #f3f4f6; color: #4b5563;">
                        All square
                      </span>
                    `}
                  </div>
                </div>
              `;
            }).join('')}
          </div>
          
          <div class="info-box neutral" style="margin-top: 1.5rem;">
            <p style="font-size: 0.875rem; color: #57534e;">
              <strong>The maths check:</strong> The total of all positive balances should equal the total of all negative balances. 
              We then create the minimum number of transfers to move money from debtors to creditors.
            </p>
          </div>
        </div>
      `;
      
      container.innerHTML = html;
    }
    
    function renderSummary() {
      const container = document.getElementById('summary');
      const rawDebts = calculateRawDebts();
      
      let html = '<div style="display: flex; flex-direction: column; gap: 1.5rem;">';
      
      people.forEach(person => {
        const summary = calculatePersonSummary(person);
        
        // Get itemized lists
        const paidItems = expenses.filter(e => e.payments[person].status === 'paid');
        const unpaidItems = expenses.filter(e => e.payments[person].status === 'unpaid');
        
        // Group unpaid by who they owe
        const unpaidByCreditor = {};
        unpaidItems.forEach(expense => {
          const payment = expense.payments[person];
          const owesTo = payment.owesTo || expense.bookedBy;
          if (!unpaidByCreditor[owesTo]) {
            unpaidByCreditor[owesTo] = [];
          }
          unpaidByCreditor[owesTo].push({
            item: expense.item,
            amount: payment.amount
          });
        });
        
        // Get what others owe this person (itemized)
        const owedByOthers = {};
        expenses.forEach(expense => {
          people.forEach(other => {
            if (other !== person) {
              const payment = expense.payments[other];
              const owesTo = payment.owesTo || expense.bookedBy;
              
              if (payment.status === 'unpaid' && owesTo === person) {
                if (!owedByOthers[other]) {
                  owedByOthers[other] = [];
                }
                owedByOthers[other].push({
                  item: expense.item,
                  amount: payment.amount
                });
              }
            }
          });
        });
        
        html += `
          <div class="card" style="padding: 0; overflow: hidden;">
            <!-- Header -->
            <div style="padding: 1.5rem; background: #f8f5f0; border-bottom: 1px solid #e8e0d0; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
              <div style="display: flex; align-items: center; gap: 0.75rem;">
                <div class="avatar neutral" style="width: 3.5rem; height: 3.5rem; font-size: 1.25rem;">${person[0]}</div>
                <div>
                  <h2 style="font-size: 1.25rem; font-weight: 600; color: #44403c;">${person}</h2>
                  <p style="font-size: 0.875rem; color: #78716c;">Total trip cost: ${formatCurrency(summary.totalPaid + summary.totalOwed)}</p>
                </div>
              </div>
              <div style="text-align: right;">
                <div style="font-size: 0.875rem; color: #78716c;">Net position</div>
                <div style="font-size: 1.25rem; font-weight: 700; color: ${summary.totalOwed > 0 ? '#b45309' : '#4a7c4a'};">
                  ${summary.totalOwed > 0 ? `Owes ${formatCurrency(summary.totalOwed)}` : 'All paid ‚úì'}
                </div>
              </div>
            </div>
            
            <div style="padding: 1.5rem;">
              <div class="optimization-grid">
                <!-- PAID ITEMS - Itemized -->
                <div>
                  <h3 style="font-weight: 600; color: #57534e; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span style="width: 1.5rem; height: 1.5rem; border-radius: 50%; background: #dcfce7; color: #15803d; display: flex; align-items: center; justify-content: center; font-size: 0.75rem;">‚úì</span>
                    Already Paid
                  </h3>
                  <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                    ${paidItems.length > 0 ? paidItems.map(expense => `
                      <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: #f0fdf0; border-radius: 0.5rem; font-size: 0.875rem;">
                        <span style="color: #166534;">${expense.item}</span>
                        <span style="font-weight: 500; color: #15803d;">${formatCurrency(expense.payments[person].amount)}</span>
                      </div>
                    `).join('') : '<p style="font-size: 0.875rem; color: #a8a29e; font-style: italic;">No payments yet</p>'}
                    ${paidItems.length > 0 ? `
                      <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: #dcfce7; border-radius: 0.5rem; font-weight: 600;">
                        <span style="color: #166534;">Total Paid</span>
                        <span style="color: #15803d;">${formatCurrency(summary.totalPaid)}</span>
                      </div>
                    ` : ''}
                  </div>
                </div>
                
                <!-- UNPAID ITEMS - Itemized by who they owe -->
                <div>
                  <h3 style="font-weight: 600; color: #57534e; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span style="width: 1.5rem; height: 1.5rem; border-radius: 50%; background: #fef3c7; color: #b45309; display: flex; align-items: center; justify-content: center; font-size: 0.75rem;">‚óã</span>
                    Still Owes
                  </h3>
                  <div style="display: flex; flex-direction: column; gap: 1rem;">
                    ${Object.keys(unpaidByCreditor).length > 0 ? 
                      Object.entries(unpaidByCreditor).map(([creditor, items]) => `
                        <div>
                          <p style="font-size: 0.75rem; font-weight: 500; color: #b45309; margin-bottom: 0.5rem;">‚Üí Owes ${creditor}:</p>
                          <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                            ${items.map(item => `
                              <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: #fef9f0; border-radius: 0.5rem; font-size: 0.875rem;">
                                <span style="color: #92400e;">${item.item}</span>
                                <span style="font-weight: 500; color: #b45309;">${formatCurrency(item.amount)}</span>
                              </div>
                            `).join('')}
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: #fef3e2; border-radius: 0.5rem; font-size: 0.875rem; font-weight: 600;">
                              <span style="color: #92400e;">Subtotal ‚Üí ${creditor}</span>
                              <span style="color: #b45309;">${formatCurrency(items.reduce((sum, i) => sum + i.amount, 0))}</span>
                            </div>
                          </div>
                        </div>
                      `).join('') : '<p style="font-size: 0.875rem; color: #15803d; font-weight: 500;">All paid up! ‚úì</p>'
                    }
                    ${unpaidItems.length > 0 ? `
                      <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: #fef3e2; border: 2px solid #f59e0b; border-radius: 0.5rem; font-weight: 600;">
                        <span style="color: #92400e;">Total Outstanding</span>
                        <span style="color: #b45309;">${formatCurrency(summary.totalOwed)}</span>
                      </div>
                    ` : ''}
                  </div>
                </div>
              </div>
              
              <!-- OWED BY OTHERS - Itemized -->
              ${Object.keys(owedByOthers).length > 0 ? `
                <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #e8e0d0;">
                  <h3 style="font-weight: 600; color: #57534e; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span style="width: 1.5rem; height: 1.5rem; border-radius: 50%; background: #dbeafe; color: #1d4ed8; display: flex; align-items: center; justify-content: center; font-size: 0.75rem;">‚Üê</span>
                    Owed by Others (as booker)
                  </h3>
                  <div class="optimization-grid">
                    ${Object.entries(owedByOthers).map(([debtor, items]) => `
                      <div style="padding: 0.75rem; background: #eff6ff; border-radius: 0.5rem;">
                        <p style="font-size: 0.875rem; font-weight: 500; color: #1e40af; margin-bottom: 0.5rem;">‚Üê ${debtor} owes ${person}:</p>
                        <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                          ${items.map(item => `
                            <div style="display: flex; justify-content: space-between; font-size: 0.875rem;">
                              <span style="color: #1d4ed8;">${item.item}</span>
                              <span style="font-weight: 500; color: #1e40af;">${formatCurrency(item.amount)}</span>
                            </div>
                          `).join('')}
                          <div style="display: flex; justify-content: space-between; font-size: 0.875rem; font-weight: 600; padding-top: 0.25rem; border-top: 1px solid #bfdbfe; margin-top: 0.25rem;">
                            <span style="color: #1e40af;">Subtotal</span>
                            <span style="color: #1e40af;">${formatCurrency(items.reduce((sum, i) => sum + i.amount, 0))}</span>
                          </div>
                        </div>
                      </div>
                    `).join('')}
                  </div>
                </div>
              ` : ''}
            </div>
          </div>
        `;
      });
      
      html += '</div>';
      container.innerHTML = html;
    }
    
    function renderExpenses() {
      const container = document.getElementById('expenses');
      
      let html = '';
      
      expenses.forEach(expense => {
        html += `
          <div class="expense-card">
            <div class="expense-header">
              <div>
                <div class="expense-title">${expense.item}</div>
                <div class="expense-meta">
                  Booked by <strong>${expense.bookedBy}</strong>${expense.bookedBySecondary ? ` & <strong>${expense.bookedBySecondary}</strong>` : ''}
                  ${expense.nights ? ` ‚Ä¢ ${expense.nights} night${expense.nights > 1 ? 's' : ''}` : ''}
                  ${expense.days ? ` ‚Ä¢ ${expense.days} days` : ''}
                </div>
                ${expense.note ? `<div class="expense-note">${expense.note}</div>` : ''}
              </div>
              <div class="expense-total">
                <div class="expense-total-amount">${formatCurrency(expense.total)}</div>
                <div class="expense-per-person">${formatCurrency(expense.perPerson)} pp</div>
              </div>
            </div>
            
            <div class="expense-payments">
              ${people.map(person => {
                const payment = expense.payments[person];
                return `
                  <div class="expense-payment ${payment.status}">
                    <div class="expense-payment-header">
                      <div class="avatar neutral">${person[0]}</div>
                      <span>${person}</span>
                    </div>
                    <div class="expense-payment-amount">${formatCurrency(payment.amount)}</div>
                    <span class="status-badge ${payment.status}">${payment.status === 'paid' ? '‚úì Paid' : '‚óã Unpaid'}</span>
                    ${payment.owesTo && payment.status === 'unpaid' ? `<div class="payment-note">‚Üí Pay ${payment.owesTo}</div>` : ''}
                    ${payment.note ? `<div class="payment-note">${payment.note}</div>` : ''}
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html;
    }
    
    function renderSettlements() {
      const container = document.getElementById('settlements');
      
      const unpaidExpenses = expenses.filter(e => 
        Object.values(e.payments).some(p => p.status === 'unpaid')
      );
      
      let html = `
        <div class="card">
          <h2 class="card-title" style="margin-bottom: 1.5rem;">Outstanding Payments (Before Netting)</h2>
          
          <div style="overflow-x: auto;">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Sam</th>
                  <th>Huss</th>
                  <th>Sharon</th>
                  <th>Jhye</th>
                </tr>
              </thead>
              <tbody>
                ${unpaidExpenses.map(expense => `
                  <tr>
                    <td>${expense.item}</td>
                    ${people.map(person => {
                      const payment = expense.payments[person];
                      return `
                        <td>
                          ${payment.status === 'unpaid' ? 
                            `<span class="unpaid-amount">${formatCurrency(payment.amount)}</span>` : 
                            `<span class="dash">‚Äî</span>`
                          }
                        </td>
                      `;
                    }).join('')}
                  </tr>
                `).join('')}
              </tbody>
              <tfoot>
                <tr>
                  <td>Total Outstanding</td>
                  ${people.map(person => {
                    const total = expenses.reduce((sum, e) => {
                      const payment = e.payments[person];
                      return sum + (payment.status === 'unpaid' ? payment.amount : 0);
                    }, 0);
                    return `<td style="color: ${total > 0 ? '#b45309' : '#4a7c4a'};">${formatCurrency(total)}</td>`;
                  }).join('')}
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
        
        <div class="card">
          <h3 class="card-title" style="margin-bottom: 1rem;">Payment Status Key</h3>
          <div class="legend">
            <div class="legend-item">
              <div class="legend-color paid"></div>
              <span>Paid</span>
            </div>
            <div class="legend-item">
              <div class="legend-color unpaid"></div>
              <span>Unpaid</span>
            </div>
          </div>
        </div>
      `;
      
      container.innerHTML = html;
    }
    
    // Tab switching
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        btn.classList.add('active');
        const tabId = btn.dataset.tab;
        document.getElementById(tabId).classList.add('active');
        
        // Render content
        switch(tabId) {
          case 'netsettlements':
            renderNetSettlements();
            break;
          case 'summary':
            renderSummary();
            break;
          case 'expenses':
            renderExpenses();
            break;
          case 'settlements':
            renderSettlements();
            break;
        }
      });
    });
    
    // Initial render
    renderNetSettlements();
  </script>
</body>
</html>
